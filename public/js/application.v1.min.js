var hermes=angular.module("hermes",["ui.router","ui.materialize"]);hermes.constant("config",{databaseURL:"http://hermes.api.dev",usuarios:"/usuarios",equipos:"/equipos",servidores:"/servidores",switches:"/switches",puertos:"/puertos",vlans:"/vlans",version:"0.1.2"});hermes.constant("Switches",{general:"http://hermes.api.dev/switches",single:"http://hermes.api.dev/switches/",home:"/#/switches"});hermes.constant("Servidores",{general:"http://hermes.api.dev/servidores",single:"http://hermes.api.dev/servidores/"});hermes.constant("Equipos",{general:"http://hermes.api.dev/equipos",single:"http://hermes.api.dev/equipos/"});hermes.constant("Puertos",{general:"http://hermes.api.dev/puertos",single:"http://hermes.api.dev/puertos/"});
hermes.config(function($stateProvider,$urlRouterProvider,$httpProvider){function wherever_we_are(are){var are=window.location;return are.origin+are.pathname}$urlRouterProvider.otherwise("/");$stateProvider.state("index",{url:"/",templateUrl:wherever_we_are()+"view/login.html",controller:"login_controller"}).state("login",{url:"/login",templateUrl:wherever_we_are()+"view/login.html",controller:"login_controller"}).state("forget",{url:"/forget",templateUrl:wherever_we_are()+"view/forget.html",controller:"forget_controller"}).state("register",{url:"/register",templateUrl:wherever_we_are()+"view/register.html",controller:"register_controller"}).state("dashboard",{url:"/dashboard",templateUrl:wherever_we_are()+"view/dashboard.html",controller:"dashboard_controller"}).state("servidores",{url:"/servidores",templateUrl:wherever_we_are()+"view/servidores.html",controller:"servidores_controller"}).state("switches",{url:"/switches",templateUrl:wherever_we_are()+"view/switches.html",controller:"switches_controller"}).state("equipos",{url:"/equipos",templateUrl:wherever_we_are()+"view/equipos.html",controller:"equipos_controller"}).state("settings",{url:"/settings",templateUrl:wherever_we_are()+"view/settings.html",controller:"settings_controller"}).state("profile",{url:"/me",templateUrl:wherever_we_are()+"view/profile.html",controller:"profile_controller"}).state("admin",{url:"/admin",templateUrl:wherever_we_are()+"view/admin.html",controller:"admin_controller"}).state("net",{url:"/conexiones",templateUrl:wherever_we_are()+"view/net.html",controller:"net_controller"}).state("single_switche",{url:"/switches/:id",templateUrl:wherever_we_are()+"view/single-switches.html",controller:"single_switches_controller"}).state("single_equipo",{url:"/equipos/:id",templateUrl:wherever_we_are()+"view/single-equipos.html",controller:"single_equipos_controller"}).state("single_servidores",{url:"/servidores/:id",templateUrl:wherever_we_are()+"view/single-servidores.html",controller:"single_servidores_controller"})});
hermes.controller("create_modal",function($scope){$(".button-create").sideNav({menuWidth:500,draggable:true})});
hermes.controller("dashboard_controller",function($scope,Progres,Query,Auth,Switches,Servidores,Equipos,Puertos){Auth.getUser(localStorage.id,function(user){$scope.user=user.data;$scope.user.active=true});Query.getAll(Switches.general,function(switches){$scope.switches=switches.data;Progres.loaded()});Query.getAll(Servidores.general,function(servidores){$scope.servidores=servidores.data;Progres.loaded()});Query.getAll(Equipos.general,function(equipos){$scope.equipos=equipos.data;Progres.loaded()});Query.getAll(Puertos.general,function(puertos){$scope.puertos=puertos.data;Progres.loaded()});$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("equipos_controller",function($scope,Query,Equipos,Progres){Query.getAll(Equipos.general,function(equipos){$scope.equipos=equipos.data;Progres.loaded()});$scope.equipo={};$scope.crearEquipos=function(datos){Query.sendNudes(Equipos.general,datos)};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("forget_controller",function($scope,$location,$window){console.log("Recuperar la contraseña de los usuarios")});
hermes.controller("indexController",function(Session){console.info("%c Hermes","color:#3f51b5;font-size:3.2em;")});
hermes.controller("login_controller",function($scope,Auth,Progres){$scope.AuthLogin=function(user){Progres.progressloading();Auth.login(user);document.getElementById("quickstart-sign-in").disabled=true}});
hermes.controller("nav",function($scope,$window,Session){$scope.logout=function(){localStorage.removeItem("id");$window.location.href="#/"}});
hermes.controller("net_controller",function($scope,$location,$window,Progres,Query,config){console.log("Anidaciones para siempre")});
hermes.controller("profile_controller",function($scope,Progres,Auth){Auth.getUser(localStorage.id,function(user){$scope.user=user.data;$scope.user.active=true;Progres.loaded()});$scope.updateInfoUser=function(datos){Auth.updateUser(localStorage.id,datos);Progres.loaded()}});
hermes.controller("register_controller",function($scope,Progres,Auth,$location,Query,config){function randomString(){var text=" ";var posissible="ABCDFGHIJKLMNOPQRSTUVWXYZabcdfghijklmnopqrstuvwxyz";for(var i=0;i<32;i++)text+=posissible.charAt(Math.floor(Math.random()*posissible.length));return text}$scope.user={super_permission:0,remember_token:randomString()};$scope.AuthRegister=function(user){Progres.progressloading();Auth.register($scope.user);document.getElementById("quickstart-sign-up").disabled=true}});
hermes.controller("servidores_controller",function($scope,Progres,Servidores,Query){Query.getAll(Servidores.general,function(servidores){$scope.servidores=servidores.data;Progres.loaded()});$scope.servidor={};$scope.crearServidor=function(datos){Query.sendNudes(Servidores.general,datos)};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("settings_controller",function($scope,$location,$window,Progres,Query,config){console.log("Configuraciones")});
hermes.controller("single_equipos_controller",function($scope,Query,Equipos,$stateParams,Progres){var ruta=Equipos.single+$stateParams.id;Query.getAll(ruta,function(equipo){$scope.equipo=equipo.data;Progres.loaded()});$scope.update=function(datos){Progres.progressloading();Query.updateDates(ruta,datos)};$scope.delete=function(){Progres.progressloading()};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("single_servidores_controller",function($scope,$stateParams,Progres,Query,Servidores){var ruta=Servidores.single+$stateParams.id;Query.getAll(ruta,function(servidor){$scope.servidor=servidor.data;Progres.loaded()});$scope.update=function(datos){Progres.progressloading();Query.updateDates(ruta,datos)};$scope.delete=function(){Progres.progressloading();Query.killme(ruta)};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("single_switches_controller",function($scope,Switches,$stateParams,Progres,Query){var ruta=Switches.single+$stateParams.id;Query.getAll(ruta,function(sw){$scope.switche=sw.data;Progres.loaded()});$scope.update=function(datos){Progres.progressloading();Query.updateDates(ruta,datos)};$scope.delete=function(){Progres.progressloading();var confirma=confirm("¿Quieres eliminar este Swtiche y todas sus conexiones?");if(confirma===true){Query.killme(ruta,Switches.home)}else{console.log("Se cancelo la eliminacion del swtiche "+$stateParams.id)}Progres.loaded_single()};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("switches_controller",function($scope,Switches,Progres,Query){Query.getAll(Switches.general,function(switches){$scope.switches=switches.data;Progres.loaded()});$scope.sw={};$scope.crearSW=function(datos){Query.sendNudes(Switches.general,datos)};$scope.verModulos=function(){Materialize.toast("Esta funcion aun no esta lista",4e3)}});
hermes.controller("switches_puertos_equipos",function($scope,Switches,$stateParams,Progres,Query,config){var ruta=Switches.single+$stateParams.id+config.puertos;Query.getAll(ruta,function(puertosFrist){var puertos=new Array;var obtenerDatos=function(url){var consulta=$.ajax({url:url,async:false,success:function(success){puertos.push(success.data)}});return consulta};for(var i=0;i<puertosFrist.data.length;i++){obtenerDatos(config.databaseURL+config.puertos+"/"+puertosFrist.data[i].id+config.equipos)}var puertosEquipos={all:puertos};$scope.puertosEquipos=puertosEquipos.all;Progres.loaded_single("#equiposload")},function(error){if(error.code===404){var puertos=new Array;var puertosEquipos={all:puertos};$scope.puertosEquipos=puertosEquipos.all;Progres.loaded_single("#equiposload")}});$scope.delete_relation=function(puerto,equipo){Progres.progressloading();var confirma=confirm("¿Quieres eliminar esta conexion?");if(confirma===true){console.log(puerto);console.log(equipo)}else{console.log("Se cancelo la eliminacion de la relacion "+$stateParams.id)}Progres.loaded()}});hermes.controller("add_equipos_switches",function($scope,$stateParams,Equipos,Query,Progres){Query.getAll(Equipos.general,function(equipos){for(var i=0;i<equipos.data.length;i++){$("#equiposOptions").append("<option value="+equipos.data[i].id+">"+equipos.data[i].name+"</option>")}for(var i=0;i<49;i++){$("#puertosOptions").append("<option value="+i+"> Puerto fa0/"+i+"</option>")}});$scope.PuertoEquipo=function(relation){Progres.progressloading();Query.relation($stateParams.id,relation.element2,relation.element1)}});
hermes.controller("switches_puertos_servidores",function($scope,Switches,$stateParams,Progres,Query,config){var ruta=Switches.single+$stateParams.id+config.puertos;Query.getAll(ruta,function(puertosFrist){var puertos=new Array;var obtenerDatos=function(url){var consulta=$.ajax({url:url,async:false,success:function(success){puertos.push(success.data)},error:function(error){console.log("El puerto no tiene servidores asignados")}});return consulta};for(var i=0;i<puertosFrist.data.length;i++){obtenerDatos(config.databaseURL+config.puertos+"/"+puertosFrist.data[i].id+config.servidores)}var puertosServidores={all:puertos};$scope.puertosServidores=puertosServidores.all;Progres.loaded_single()})});
hermes.controller("switches_puertos_switches",function($scope,Switches,$stateParams,Progres,Query,config){var ruta=Switches.single+$stateParams.id+config.puertos;Query.getAll(ruta,function(puertosFrist){var puertos=new Array;var obtenerDatos=function(url){var consulta=$.ajax({url:url,async:false,success:function(success){puertos.push(success.data)}});return consulta};for(var i=0;i<puertosFrist.data.length;i++){obtenerDatos(config.databaseURL+config.puertos+"/"+puertosFrist.data[i].id+config.swtiches)}var puertosSwitche={all:puertos};$scope.puertosSwitche=puertosSwitche.all;Progres.loaded_single()})});
hermes.directive("preloader",function(){return{restrict:"EA",templateUrl:"../view/directives/preloader.html",directivaExiste:function(){console.log("Directiva funciona")}}});

hermes.service("Auth",function($http,$window,$location,config,Progres,Session){var that=this;this.getUser=function(userID,success,failure){$http.get(config.databaseURL+config.usuarios+"/"+userID).success(success).error(failure)};this.updateUser=function(userID,datos){$http({url:config.databaseURL+config.usuarios+"/"+userID,method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(datos)}).success(function(success){Materialize.toast("Los datos de usuario fueron actualizados",4e3);$(".progress-update").addClass("hide")}).error(function(error){Materialize.toast("Ocurrio un error al actualizar tus datos",4e3);console.log(JSON.stringify(error))})};this.login=function(user,success,failure){$http({url:config.databaseURL+"/auth/login",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(user)}).then(function(success){Session.saveUser(success.data.data[0].id);$window.location.href="#/dashboard"},function(error){if(error.status=="402"){Materialize.toast("La contraseña es incorrecta",3e3);document.getElementById("quickstart-sign-in").disabled=false;Progres.progressloaded()}else if(error.status=="404"){Materialize.toast("No hay un usuario registrado con este correo",6e3);document.getElementById("quickstart-sign-in").disabled=false;Progres.progressloaded()}else{console.log(JSON.stringify(error));Materialize.toast("Ocurrio un error desconocido al intentar acceder",6e3);document.getElementById("quickstart-sign-in").disabled=false;Progres.progressloaded()}})};this.register=function(user,success,failure){$http({url:config.databaseURL+"/auth/register",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(user)}).then(function(success){Materialize.toast("Bienvenido - Ahora eres usuario de Hermes",4e3);Progres.progressloaded();Session.saveUser(success.data.data[0].id);$window.location.href="#/dashboard"},function(error){console.log(JSON.stringify(error));if(error.status=="402"){Materialize.toast("Este correo ya esta en uso por otro usuario",3e3);document.getElementById("quickstart-sign-up").disabled=false;Progres.progressloaded()}else{console.log(JSON.stringify(error));Materialize.toast("Ocurrio un error desconocido al intentar registrarte",6e3);document.getElementById("quickstart-sign-up").disabled=false;Progres.progressloaded()}})}});
hermes.service("materialize",function(){$(".button-edit").sideNav({menuWidth:600,edge:"left",draggable:true});$("select").material_select();$(".dropdown-button").dropdown()});
hermes.service("Progres",function(){this.progressloading=function(argument){$(".progress-update").removeClass("hide")};this.progressloaded=function(argument){$(".progress-update").addClass("hide")};this.loaded=function(argument){$(".load").addClass("hide");$(".table__content").removeClass("hide");$(".btn").removeClass("disabled");$(".progress-load").addClass("hide")};this.loaded_single=function(elemento){$(elemento).addClass("hide")};this.itsClear=function(argument){$(".loadClear").removeClass("hide")};this.fuckMenSalioMal=function(argument){$(".loadError").removeClass("hide")}});
hermes.service("Query",function($http,$window,config){this.getAll=function(urlDefine,success,failure){$http.get(urlDefine).success(success).error(failure)};this.sendNudes=function(urlDefine,datos){$http({url:urlDefine,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(datos)}).then(function(response){Materialize.toast("El elemento fue creado",4e3);console.log(JSON.stringify(response))},function(response){Materialize.toast("Ocurrio un error al crear el elemento",4e3);console.log(JSON.stringify(response))})};this.updateDates=function(urlDefine,datos){$http({url:urlDefine,method:"PATCH",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param(datos)}).success(function(success){Materialize.toast("Tu elemento fue actualizado",4e3);$(".progress-update").addClass("hide")}).error(function(error){Materialize.toast("Ocurrio un error al actualizar el elemento",4e3);console.log(JSON.stringify(error))})};this.killme=function(urlDefine,goHome){$http.delete(urlDefine).success(function(success){Materialize.toast("El elemento fue eliminado",4e3);console.log(success);$window.location.href=goHome}).error(function(error){Materialize.toast("Ocurrio un error al eliminar el elemento",4e3);console.log(error)})};this.relation=function(switche,puerto,equipo){$http({url:config.databaseURL+config.switches+"/"+switche+config.puertos+"/"+puerto,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){Materialize.toast("Se activo el puerto "+puerto+" del switche "+switche,4e3);console.log(JSON.stringify(response))},function(response){Materialize.toast("Ocurrio un error al activar el puerto "+puerto+" con el switche "+switche,4e3);console.log(JSON.stringify(response));console.log(response.status)});$http({url:config.databaseURL+config.equipos+"/"+equipo+config.puertos+"/"+puerto,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(response){$(".progress-update").addClass("hide");Materialize.toast("Se conecto el equipo "+equipo+" al puerto "+puerto,4e3);console.log(JSON.stringify(response))},function(response){console.log(JSON.stringify(response));console.log(response.status)})};this.relationKill=function(switche,puerto,equipo){$http.delete(config.databaseURL+config.equipos+"/"+equipo+config.puertos+"/"+puerto).success(function(success){Materialize.toast("El elemento puerto fue eliminado",4e3);console.log(success)}).error(function(error){Materialize.toast("Ocurrio un error al eliminar el elemento",4e3);console.log(error)});$http.delete(config.databaseURL+config.switches+"/"+switche+config.puertos+"/"+puerto).success(function(success){Materialize.toast("El elemento puerto fue eliminado",4e3);console.log(success)}).error(function(error){Materialize.toast("Ocurrio un error al eliminar el elemento",4e3);console.log(error)})}});
hermes.service("Session",function($http,config,$window){this.saveUser=function(userId){localStorage.setItem("id",userId);$http.get(config.databaseURL+config.usuarios+"/"+userId).success(function(userForLocal){var u=userForLocal.data;localStorage.setItem("name",u.name);localStorage.setItem("mail",u.mail);localStorage.setItem("state","active");localStorage.setItem("token",u.remember_token)}).error(function(error){console.log(error)})}});(function(userId){var that=this;this.userId=userId;var opciones=[undefined,"number","string"];if(typeof this.userId==opciones[0]||this.userId===undefined){destroyUser();$(location).attr("href","#/");console.warn("Session Clear")}else if(isNaN(this.userId)===false&&typeof this.userId!==undefined){if(window.location.hash==="#/login"||window.location.hash==="#/register"||window.location.hash==="#/"){$(location).attr("href","#/dashboard")}console.info("Hay una session iniciada");observadorStateSession()}else{console.warn("Algo salio muy mal")}function observadorStateSession(){setTimeout(function(){if(isNaN(that.userId)===false&&typeof that.userId!=undefined){console.info("La session es estable");observadorStateSession()}else{destroyUser()}},1e4)}function destroyUser(){var infoUser=["id","name","mail","state","token"];for(var i=0;i<infoUser.length;i++){localStorage.removeItem(infoUser[i])}console.warn("Necesitas iniciar sesion para obtener tus credenciales")}})(localStorage.id);
if(navigator.serviceWorker){navigator.serviceWorker.register("sw.js").then(function(registration){console.log("ServiceWorker registration successful with scope:",registration.scope)}).catch(function(error){console.log("ServiceWorker registration failed:",error)})}
